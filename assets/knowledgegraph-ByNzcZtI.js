const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-CaAIB7vx.js","assets/index-BCSVvjKE.js","assets/index-CrYBktwj.css","assets/networkEnums-B_Ikcs9K.js","assets/GPMessage-C2O9wxvO.js","assets/GraphQueryStreaming-omjSy3Iz.js"])))=>i.map(i=>d[i]);
import{C as I,ga as y,_ as F,gd as _,w as K,eF as G,gc as P,ge as V,dh as J,cY as N,cZ as U,cX as j,aX as T,eZ as M,e_ as O,gf as Q,gg as X}from"./index-BCSVvjKE.js";import{u as b,V as Z,y as W,X as L,J as B,C as k,K as Y,Z as D,a0 as z,a1 as H,a2 as $,U as q}from"./arcade-Awqyjs4G.js";import{a as u,r as l}from"./unitConversion-EHaOLYRe.js";import{l as tt}from"./portalUtils-D2oTZczw.js";import{p as et,c as nt,t as at,a as rt,b as it}from"./GraphQueryStreaming-omjSy3Iz.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-CB1KQ4rx.js";import"./TimeOnly-CVgLqrpK.js";import"./number-B-KLSYP3.js";import"./featureConversionUtils-D8tC_IN5.js";import"./OptimizedFeature-CAs8C_6w.js";import"./memoryEstimations-B7_Jwj04.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./WhereClause-CKXQ1p-G.js";let f=null;async function ot(t){const e=J.geometryServiceUrl??"";if(!e){N()||await U();for(const n of t)n.container[n.indexer]=j(n.container[n.indexer],T.WGS84);return}const a=t.map(n=>n.container[n.indexer]),i=new M({geometries:a,outSpatialReference:T.WGS84}),s=await O(e,i);for(let n=0;n<s.length;n++){const r=t[n];r.container[r.indexer]=s[n]}}async function C(t,e){const a=new K({portal:t,id:e});return await a.load(),f===null&&(f=await F(()=>import("./knowledgeGraphService-CaAIB7vx.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5]))),await f.fetchKnowledgeGraph(a.url)}function v(t,e,a,i,s){if(t===null)return null;if(y(t)||G(t))return t;if(D(t)||D(t))return t.toJSDate();if(z(t))return t.toStorageFormat();if(H(t))return t.toStorageString();if($(t)){const n={};for(const r of t.keys())n[r]=v(t.field(r),e,a,i,s),n[r]instanceof P&&s.push({container:n,indexer:r});return n}if(_(t)){const n=t.map(r=>v(r,e,a,i,s));for(let r=0;r<n.length;r++)n[r]instanceof P&&s.push({container:n,indexer:r});return n}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?V(t):t:void 0}function st(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return X(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new u(e,l.WrongSpatialReference,null)}function R(t,e){if(!t)return null;const a={};for(const i in t)a[i]=h(t[i],e);return a}function h(t,e){return t===null?null:_(t)?t.map(a=>h(a,e)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:R(t.properties,e)}:t instanceof at?{graphType:"object",properties:R(t.properties,e)}:t instanceof rt?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:R(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(a=>h(a,e)):null}:q(t)?st(t,e):y(t)||G(t)||Q(t)?t:null}function _t(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,a){return t.standardFunctionAsync(e,a,(i,s,n)=>{var m,d;if(b(n,2,2,e,a),n[0]===null)throw new u(e,l.PortalRequired,a);if(n[0]instanceof Z){const p=W(n[1]);let g;return g=(m=e.services)!=null&&m.portal?e.services.portal:I.getDefault(),C(tt(n[0],g),p)}if(y(n[0])===!1)throw new u(e,l.InvalidParameter,a);const r=W(n[0]);return C(((d=e.services)==null?void 0:d.portal)??I.getDefault(),r)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,a){return t.standardFunctionAsync(e,a,async(i,s,n)=>{var x;b(n,2,4,e,a);const r=n[0];if(!L(r))throw new u(e,l.InvalidParameter,a);const m=n[1];if(!y(m))throw new u(e,l.InvalidParameter,a);f===null&&(f=await F(()=>import("./knowledgeGraphService-CaAIB7vx.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5])));let d=null;const p=B(n[2],null);if(!(p instanceof k||p===null))throw new u(e,l.InvalidParameter,a);if(p){let o=[];d=v(p,!0,!1,e,o),o=o.filter(c=>!c.container[c.indexer].spatialReference.isWGS84),o.length>0&&await ot(o)}const g=new et({openCypherQuery:m,bindParameters:d});(((x=r==null?void 0:r.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(g.outputSpatialReference=e.spatialReference);const A=(await f.executeQueryStreaming(r,g)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:o,value:c}=await A.read();if(o)break;if(_(c))for(const w of c)S.push(h(w,e));else{const w=[];for(const E of c)w.push(h(c[E],e));S.push(w)}}}catch(o){throw o}return k.convertJsonToArcade(S,Y(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{_t as registerFunctions};
