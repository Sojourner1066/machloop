import{c as A,a as S}from"./devEnvironmentUtils-CnNDiFMM.js";import{a4 as D,I as u,s as p,ep as w,eq as v,er as C,es as N,et as U}from"./index-BnvXCOal.js";import{m as F}from"./jsonUtils-Du5tZPpz.js";import{p as O,m as P,i as M,y as R,h as W}from"./styleUtils-CWAJkKJj.js";import{e as $}from"./webStyleAcceptedFormats-CG7ZQ6BV.js";import"./defaults-Bcfj-Otq.js";import"./defaultsJSON-GKolV7NZ.js";function X(t,e,l){const a=t.name;return a==null?Promise.reject(new p("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName==="Esri2DPointSymbolsStyle"?B(a,e,l):M(t,e,l).then(o=>z(o,a,e,R,l))}function k(t,e){return e.items.find(l=>l.name===t)}async function z(t,e,l,a,o){var h,g;const n=(l==null?void 0:l.portal)!=null?l.portal:D.getDefault(),s={portal:n,url:u(t.baseUrl)},m=k(e,t.data);if(!m)throw new p("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});const c=(o==null?void 0:o.acceptedFormats)??$,b=a(m,c);if(!b)throw new p("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${e}' does not have an accepted format (one of ${c})`,{symbolName:e});const{url:T,format:E}=b;let i=w(T,s),y=((h=m.thumbnail)==null?void 0:h.href)??null;const f=(g=m.thumbnail)==null?void 0:g.imageData;A()&&(i=S(i)??"",y=S(y));const I={portal:n,url:u(v(i)),origin:"portal-item"};return O(i,o).then(d=>{const q=E==="cim"?P(d.data):d.data,r=F(q,I);if(r&&C(r)){if(y){const x=w(y,s);r.thumbnail=new N({url:x})}else f&&(r.thumbnail=new N({url:`data:image/png;base64,${f}`}));t.styleUrl?r.styleOrigin=new U({portal:l.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(r.styleOrigin=new U({portal:l.portal,styleName:t.styleName,name:e}))}return r})}function B(t,e,l){const a=W.replaceAll(/\{SymbolName\}/gi,t),o=e.portal!=null?e.portal:D.getDefault();return O(a,l).then(n=>{const s=P(n.data);return F(s,{portal:o,url:u(v(a)),origin:"portal-item"})})}export{z as fetchSymbolFromStyle,k as getStyleItemFromStyle,X as resolveWebStyleSymbol};
